#!/usr/bin/env python

import spi
from time import sleep
# FONT: https://www.youtube.com/watch?v=gODVeG_qio8

FONT = {
    "A":[
        "11111100",
        "00010010",
        "00010010",
        "00010010",
        "11111100",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "B":[
        "11111110",
        "10001010",
        "10001010",
        "10001010",
        "01110100",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "C":[
        "01111100",
        "10000010",
        "10000010",
        "10000010",
        "01000100",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "D":[
        "11111110",
        "10000010",
        "10000010",
        "10000010",
        "01111100",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "E":[
        "11111110",
        "10001010",
        "10001010",
        "10000010",
        "10000010",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "F":[
        "11111110",
        "00001010",
        "00001010",
        "00000010",
        "00000010",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "G":[
        "01111100",
        "10000010",
        "10000010",
        "10001010",
        "01111010",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "H":[
        "11111110",
        "00010000",
        "00010000",
        "00010000",
        "11111110",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "I":[
        "10000010",
        "11111110",
        "10000010",
        "00000000",
        "00000000",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "J":[
        "01000000",
        "10000000",
        "10000000",
        "10000000",
        "01111110",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "K":[
        "11111110",
        "00001000",
        "00001000",
        "00010100",
        "11100010",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "L":[
        "11111110",
        "10000000",
        "10000000",
        "10000000",
        "10000000",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "M":[
        "11111110",
        "00000100",
        "00001000",
        "00000100",
        "11111110",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "N":[
        "11111110",
        "00000100",
        "00001000",
        "00010000",
        "11111110",
        "00000000",
        "00000000",
        "00000000"
    ],

    "O":[
        "01111100",
        "10000010",
        "10000010",
        "10000010",
        "01111100",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "P":[
        "11111110",
        "00001010",
        "00001010",
        "00001010",
        "00000100",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "Q":[
        "01111100",
        "10000010",
        "10000010",
        "01000010",
        "10111100",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "R":[
        "11111110",
        "00001010",
        "00001010",
        "00001010",
        "11110100",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "S":[
        "01000100",
        "10001010",
        "10001010",
        "10001010",
        "01110010",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "T":[
        "00000010",
        "00000010",
        "11111110",
        "00000010",
        "00000010",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "U":[
        "01111110",
        "10000000",
        "10000000",
        "10000000",
        "01111110",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "V":[
        "00011110",
        "01100000",
        "10000000",
        "01100000",
        "00011110",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "W":[
        "11111110",
        "01000000",
        "00100000",
        "01000000",
        "11111110",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "X":[
        "11100010",
        "00010100",
        "00001000",
        "00010100",
        "11100010",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "Y":[
        "00000010",
        "00000100",
        "11111000",
        "00000100",
        "00000010",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "Z":[
        "11000010",
        "10100010",
        "10010010",
        "10001010",
        "10000110",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "Å":[
        "11110000",
        "00101000",
        "00101010",
        "00101000",
        "11110000",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "Ä":[
        "11110000",
        "00101010",
        "00101000",
        "00101010",
        "11110000",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    "Ö":[
        "01110000",
        "10001010",
        "10001000",
        "10001010",
        "01110000",
        "00000000",
        "00000000",
        "00000000"
    ],
    
    " ":[
        "00000000",
        "00000000",
        "00000000",
        "00000000",
        "00000000",
        "00000000",
        "00000000",
        "00000000"
    ]
}
ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZÅÄÖ"

lazy_lut = {
    1:"0001",
    2:"0010",
    3:"0011",
    4:"0100",
    5:"0101",
    6:"0110",
    7:"0111",
    8:"1000"
}


def get_font_line(char: str, line: int) -> int:
    cmd = lazy_lut[line]
    cmd += FONT[char][line - 1]
    return int(cmd, 2)

def get_font_line2(char: str, char_line: int, line: int) -> int:
    cmd = lazy_lut[line]
    cmd += FONT[char][char_line - 1]
    return int(cmd, 2)

def meow(msg: str, n: int) -> tuple[str, int]:
    idx = 0
    while n > 6:
        n = n - 6
        idx += 1
        
    return (msg[idx], n)
        
if __name__ == '__main__':
    ### Initialize an SPI connection using BCM-mode pins 21, 20, and 16
    max7219 = spi.SPI(clk=21, cs=16, mosi=20, miso=None, verbose=True)


    ### Zero out all registers
    for cmd in range(16):
        packet = cmd << 8
        max7219.put(packet,12)

    input("WAIT")

    MSG = f' BALD '
    max7219.put(int("101100000111",2),12)
    max7219.put(int("110000000001",2),12)
    for i in range(6 * (len(MSG) - 1)):
        print(i)
        for line in range(1, 8):
            a = meow(MSG, i + line)
            max7219.put(get_font_line2(a[0], a[1], line), 12)
        sleep(0.2)

    #for i in list:
    #    max7219.put(int(i, 2), 12)

    #### Enable all columns via the scan limit register
    #max7219.put(int("101100000111",2),12)

    #### Disable shutdown mode
    #max7219.put(int("110000000001",2),12)

    #### Illuminate column 2 with a specific pattern
    #max7219.put(int("001000100111",2),12)

    try:
        input("Press return to continue")
    except:
        pass
